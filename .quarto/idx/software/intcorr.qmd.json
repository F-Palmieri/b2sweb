{"title":"Computational Methods for Correcting the Drift in LC/MS Metabolomic Data in R: intCor Package","markdown":{"yaml":{"title":"Computational Methods for Correcting the Drift in LC/MS Metabolomic Data in R: intCor Package","author":"Francesc Fernández-Albert, Rafael Llorach, Cristina Andrés-Lacueva, Alexandre Perera","date":"`r Sys.Date()`","format":"html","execute":{"warning":false,"message":false,"echo":true,"eval":false},"cache":false},"headingText":"Abstract","containsRefs":false,"markdown":"\n\n\nLiquid Chromatography coupled to Mass Spectrometry (LC/MS) has become widely used in metabolomics. Several artifacts have been identified during the acquisition step in large LC/MS metabolomics experiments, including ion suppression, carryover, or changes in sensitivity and intensity. The drift effects of peak intensity are among the most frequent issues and may constitute the main source of variance in the data, leading to misleading statistical results. This document introduces the **intCor** package, which applies a methodology based on a common variance analysis prior to data normalization to address drift effects. This approach was tested and compared with four other methods using the Dunn and Silhouette indices of Quality Control classes, demonstrating superior performance.\n\n**Keywords:** Metabolomics, Drift Correction, LC/MS.\n\n# Introduction\n\nThe **intCor** package is an R tool focused on drift removal and data normalization for LC/MS metabolomic data. The package includes five different methods to correct drift effects and is structured around two main functions: one for data importation and another for drift correction. Additional functions for graphical analyses (PCA, heat maps) and output generation (CDF files) are also included.\n\n# Using intCor\n\n## Importing Data\n\nThe **importData()** function is used to read the samples or data sets that will be analyzed. It supports three input formats:\n\n-   A set of external files (e.g., **CDF** or **mzXML**)\n-   A matrix format\n-   An **xcmsSet** object\n\n### Using an External Data Matrix\n\nA data table and a class vector can be used for importing the data. The data matrix should have samples as columns and variables (time or masses) as rows. The class vector should contain class names, with its components corresponding to the order of the matrix columns.\n\n```{r}\n# Load example data\nlibrary(intCor)\ndata(intCorData)\n\n# Import data matrix\nintCor_table <- importData(data = dataMatrix, classes = classes)\n```\n\n### Using an xcmsSet Object\n\nThe **importData()** function also supports an **xcmsSet** object from the **XCMS** package. If class information is not provided, it will be retrieved from the **xcmsSet** object.\n\n```{r}\n# Load xcmsSet data\nlibrary(xcms)\ndata(intCorXCMS)\nnormInt_xcms <- importData(data = xcg)\n```\n\n### Using Sample Files\n\nIf **CDF** or **mzXML** files are provided, **intCor** performs drift correction directly on the chromatograms. The following example demonstrates how to import data using CDF files and a metadata CSV file.\n\n```{r}\n# Importing CDF files\ntab <- read.csv(\"sampTable.csv\")\nnormInt <- importData(dataDir = \"data\", fileType = \"cdf\", tabName = \"sampTable.csv\")\n```\n\n# Correcting Drift in the Data\n\nOnce data is imported, drift correction can be applied using the **corrModel()** function. The package supports five drift correction methods:\n\n1.  **Component Correction (CC)**\n2.  **Common Principal Components Analysis (CPCA)**\n3.  **CPCA + Median Normalization (CPCA-Med)**\n4.  **Median Normalization (Med)**\n5.  **Batch Compensation (ComBat)**\n\nExample of drift correction using **CPCA-Med**:\n\n```{r}\nnormInt_cpcaMed <- corrModel(normInt = normInt, method = \"cpcaMed\", modClasses = c(\"Water\", \"QC\", \"Reference\"), nComps = 1)\n```\n\nThe **corrModel()** function computes the principal components model, applies drift correction, and calculates clustering indices (Dunn and Silhouette scores) to assess data quality improvements.\n\n# intCor Output\n\nIf the data was imported through external files, it is possible to generate corrected **CDF** files as output:\n\n```{r}\ncdfFileCreator(dataMatrix = getCorrData(normInt_cpcaMed), dir2print = \"correctedCDFs\", dataDir = \"data\", fileType = \"cdf\")\n```\n\nAlternatively, the corrected data can be retrieved as a **CSV** file:\n\n```{r}\nwrite.csv(file = \"corrData_cpcaMed.csv\", getCorrData(normInt_cpcaMed))\n```\n\n# Acknowledgements\n\nThis research was supported by Spanish national grants AGL2009-13906-C02-01/ALI, AGL2010-10084-E, the CONSOLIDER INGENIO 2010 Programme, and the FUN-C-FOOD (CSD2007-063) initiative under the MICINN. Additional funding was provided by Merck Serono 2010 Research Grants and the Ramon y Cajal Programme (MICINN-RYC).\n\n## Download\n\n-   R package:[intCor_1.03.tar.gz](downloads/intCor_1.03.tar.gz)\n\n-   netCDF files for the vignette: [intCorData](downloads//intCorrData.zip)\n\n-   Vignette: [intCor_vignette](downloads/intCor_vignette.pdf)\n\n# References\n\nLeek JT, Johnson WE, Parker HS, Jaffe AE, Storey JD (2012). \"The sva package for removing batch effects and other unwanted variation in high-throughput experiments.\" Bioinformatics, 28(6), 882–883. [DOI:10.1021/ac051437y](http://dx.doi.org/10.1021/ac051437y)\n\nSmith CA, Want EJ, O’Maille G, Abagyan R, Siuzdak G (2006). \"XCMS: processing mass spectrometry data for metabolite profiling using nonlinear peak alignment, matching, and identification.\" Analytical Chemistry, 78(3), 779–787. [DOI:10.1021/ac051437y](http://pubs3.acs.org/acs/journals/doilookup?in_doi=10.1021/ac051437y)\n","srcMarkdownNoYaml":"\n\n# Abstract\n\nLiquid Chromatography coupled to Mass Spectrometry (LC/MS) has become widely used in metabolomics. Several artifacts have been identified during the acquisition step in large LC/MS metabolomics experiments, including ion suppression, carryover, or changes in sensitivity and intensity. The drift effects of peak intensity are among the most frequent issues and may constitute the main source of variance in the data, leading to misleading statistical results. This document introduces the **intCor** package, which applies a methodology based on a common variance analysis prior to data normalization to address drift effects. This approach was tested and compared with four other methods using the Dunn and Silhouette indices of Quality Control classes, demonstrating superior performance.\n\n**Keywords:** Metabolomics, Drift Correction, LC/MS.\n\n# Introduction\n\nThe **intCor** package is an R tool focused on drift removal and data normalization for LC/MS metabolomic data. The package includes five different methods to correct drift effects and is structured around two main functions: one for data importation and another for drift correction. Additional functions for graphical analyses (PCA, heat maps) and output generation (CDF files) are also included.\n\n# Using intCor\n\n## Importing Data\n\nThe **importData()** function is used to read the samples or data sets that will be analyzed. It supports three input formats:\n\n-   A set of external files (e.g., **CDF** or **mzXML**)\n-   A matrix format\n-   An **xcmsSet** object\n\n### Using an External Data Matrix\n\nA data table and a class vector can be used for importing the data. The data matrix should have samples as columns and variables (time or masses) as rows. The class vector should contain class names, with its components corresponding to the order of the matrix columns.\n\n```{r}\n# Load example data\nlibrary(intCor)\ndata(intCorData)\n\n# Import data matrix\nintCor_table <- importData(data = dataMatrix, classes = classes)\n```\n\n### Using an xcmsSet Object\n\nThe **importData()** function also supports an **xcmsSet** object from the **XCMS** package. If class information is not provided, it will be retrieved from the **xcmsSet** object.\n\n```{r}\n# Load xcmsSet data\nlibrary(xcms)\ndata(intCorXCMS)\nnormInt_xcms <- importData(data = xcg)\n```\n\n### Using Sample Files\n\nIf **CDF** or **mzXML** files are provided, **intCor** performs drift correction directly on the chromatograms. The following example demonstrates how to import data using CDF files and a metadata CSV file.\n\n```{r}\n# Importing CDF files\ntab <- read.csv(\"sampTable.csv\")\nnormInt <- importData(dataDir = \"data\", fileType = \"cdf\", tabName = \"sampTable.csv\")\n```\n\n# Correcting Drift in the Data\n\nOnce data is imported, drift correction can be applied using the **corrModel()** function. The package supports five drift correction methods:\n\n1.  **Component Correction (CC)**\n2.  **Common Principal Components Analysis (CPCA)**\n3.  **CPCA + Median Normalization (CPCA-Med)**\n4.  **Median Normalization (Med)**\n5.  **Batch Compensation (ComBat)**\n\nExample of drift correction using **CPCA-Med**:\n\n```{r}\nnormInt_cpcaMed <- corrModel(normInt = normInt, method = \"cpcaMed\", modClasses = c(\"Water\", \"QC\", \"Reference\"), nComps = 1)\n```\n\nThe **corrModel()** function computes the principal components model, applies drift correction, and calculates clustering indices (Dunn and Silhouette scores) to assess data quality improvements.\n\n# intCor Output\n\nIf the data was imported through external files, it is possible to generate corrected **CDF** files as output:\n\n```{r}\ncdfFileCreator(dataMatrix = getCorrData(normInt_cpcaMed), dir2print = \"correctedCDFs\", dataDir = \"data\", fileType = \"cdf\")\n```\n\nAlternatively, the corrected data can be retrieved as a **CSV** file:\n\n```{r}\nwrite.csv(file = \"corrData_cpcaMed.csv\", getCorrData(normInt_cpcaMed))\n```\n\n# Acknowledgements\n\nThis research was supported by Spanish national grants AGL2009-13906-C02-01/ALI, AGL2010-10084-E, the CONSOLIDER INGENIO 2010 Programme, and the FUN-C-FOOD (CSD2007-063) initiative under the MICINN. Additional funding was provided by Merck Serono 2010 Research Grants and the Ramon y Cajal Programme (MICINN-RYC).\n\n## Download\n\n-   R package:[intCor_1.03.tar.gz](downloads/intCor_1.03.tar.gz)\n\n-   netCDF files for the vignette: [intCorData](downloads//intCorrData.zip)\n\n-   Vignette: [intCor_vignette](downloads/intCor_vignette.pdf)\n\n# References\n\nLeek JT, Johnson WE, Parker HS, Jaffe AE, Storey JD (2012). \"The sva package for removing batch effects and other unwanted variation in high-throughput experiments.\" Bioinformatics, 28(6), 882–883. [DOI:10.1021/ac051437y](http://dx.doi.org/10.1021/ac051437y)\n\nSmith CA, Want EJ, O’Maille G, Abagyan R, Siuzdak G (2006). \"XCMS: processing mass spectrometry data for metabolite profiling using nonlinear peak alignment, matching, and identification.\" Analytical Chemistry, 78(3), 779–787. [DOI:10.1021/ac051437y](http://pubs3.acs.org/acs/journals/doilookup?in_doi=10.1021/ac051437y)\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":false,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"intcorr.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.13","editor":"visual","theme":{"light":"pulse","dark":"slate"},"title":"Computational Methods for Correcting the Drift in LC/MS Metabolomic Data in R: intCor Package","author":"Francesc Fernández-Albert, Rafael Llorach, Cristina Andrés-Lacueva, Alexandre Perera","date":"`r Sys.Date()`"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}